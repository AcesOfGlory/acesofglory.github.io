---
layout: minimal
published: true
---

<style type="text/css">

table {
   border-collapse: collapse;
   position: absolute;
   left: 22%;
   top: 10%;
   padding-left: 5px;
}
colgroup, tbody {
  border: solid medium;
}
td {
  border: solid thin;
  text-align: center; padding: 0;
  width: 60px;
  height: 60px;
  font-size: 22px;
}
#draggable {
  width: 18%;
  height: 10%;
  position: absolute;
  left: 2%;
  top: 9%;
}

</style>


<div id="draggable">
  <fieldset><legend>Sudoku Options</legend>
    See documentation <a href="https://www.samnayak.com/15-09-2016-sudoku/">here</a>
    <p>
      Size:
      <input id="inputHeight" type="number" min="10" max="80" value="60" style="width:35;"> x
      <input id="inputWidth" type="number" min="10" max="80" value="60" style="width:35;">

    </p>
    <p>
      Generation Algorithm:<br>
      <label><input type="radio" name="generation-algorithm" id="random" checked>Random Generation</label><br/>
      <label><input type="radio" name="generation-algorithm" id="manual">Manual Input</label>
    </p>
    <p>
      Solution Algorithm:<br>
      <label><input type="radio" name="solution-algorithm" id="backtracking" checked>Backtracking (Brute Force)</label><br>
    </p>
    <p>
      Difficulty:<br>
      <label><input type="radio" name="difficulty-setting">Easy</label><br>
      <label><input type="radio" name="difficulty-setting" checked>Medium</label><br>
      <label><input type="radio" name="difficulty-setting">Hard</label><br>
    </p>
    <h1><time>00:00:00</time></h1>

    <a href="#" onclick="newGame();return false">New Game</a>
    <input type="button" onclick="valid();return false" value="Validate"/>
    <input type="button" onclick="restart();return false" value="Restart"/>
    <input type="button" onclick="showSolution();return false" value="Show Solution"/>
    <input type="button" onclick="showStatistics();return false" value="Show Statistics"/>
    <input type="button" onclick="showRules();return false" value="Show Rules"/>
  </fieldset>
</div>

<table>
   <tr> <td id="1x1"> <td id="1x2"> <td id="1x3"> <td id="1x4"> <td id="1x5"> <td id="1x6"> <td id="1x7"> <td id="1x8"> <td id="1x9">
   <tr> <td id="2x1"> <td id="2x2"> <td id="2x3"> <td id="2x4"> <td id="2x5"> <td id="2x6"> <td id="2x7"> <td id="2x8"> <td id="2x9">
   <tr> <td id="3x1"> <td id="3x2"> <td id="3x3"> <td id="3x4"> <td id="3x5"> <td id="3x6"> <td id="3x7"> <td id="3x8"> <td id="3x9">
  <colgroup><col><col><col>
  <tbody>
   <tr> <td id="4x1"> <td id="4x2"> <td id="4x3"> <td id="4x4"> <td id="4x5"> <td id="4x6"> <td id="4x7"> <td id="4x8"> <td id="4x9">
   <tr> <td id="5x1"> <td id="5x2"> <td id="5x3"> <td id="5x4"> <td id="5x5"> <td id="5x6"> <td id="5x7"> <td id="5x8"> <td id="5x9">
   <tr> <td id="6x1"> <td id="6x2"> <td id="6x3"> <td id="6x4"> <td id="6x5"> <td id="6x6"> <td id="6x7"> <td id="6x8"> <td id="6x9">
  <colgroup><col><col><col>
  <tbody>
   <tr> <td id="7x1"> <td id="7x2"> <td id="7x3"> <td id="7x4"> <td id="7x5"> <td id="7x6"> <td id="7x7"> <td id="7x8"> <td id="7x9">
   <tr> <td id="8x1"> <td id="8x2"> <td id="8x3"> <td id="8x4"> <td id="8x5"> <td id="8x6"> <td id="8x7"> <td id="8x8"> <td id="8x9">
   <tr> <td id="9x1"> <td id="9x2"> <td id="9x3"> <td id="9x4"> <td id="9x5"> <td id="9x6"> <td id="9x7"> <td id="9x8"> <td id="9x9">
</table>

<script type="text/javascript">

const HIGHLIGHT_COLOUR = "#ADD8E6";
const FIXED_NUMBER_COLOUR = "#DDDDDD";

if (typeof(Storage) !== "undefined") {
  var correctSolutions = localStorage.correctSolutions ? +localStorage.correctSolutions : 0;
  var attempts = localStorage.attempts ? +localStorage.attempts : 0;
  var givenUp = localStorage.givenUp ? +localStorage.givenUp : 0;
  var shortestTime = localStorage.shortestTime ? +localStorage.shortestTime : null;
}

function showStatistics(){
  alert(`Statistics\n------------\n\n`
      + `Attempts: ${attempts}\n`
      + `Correct Solutions: ${correctSolutions}\n`
      + `Given Up: ${givenUp}\n`
      + `Shortest Time: ${shortestTime}`
    );
}

function showRules(){
  alert(`Rules\n-------\n\n`
      + `1. No duplicates of the numbers 1-9 horizontally\n`
      + `2. No duplicates of the numbers 1-9 vertically\n`
      + `3. No duplicates of the numbers 1-9 in the 3x3 cell groups`
    );
}



var currentObj;
var previousObj;

function initialise(e){
  currentObj = this;
  if (previousObj && previousObj.style.backgroundColor == "rgb(221, 221, 221)")
    previousObj = currentObj;

  currentObj.style.backgroundColor = HIGHLIGHT_COLOUR;

  if (previousObj === undefined)
    previousObj = currentObj;
  else {
    previousObj.style.backgroundColor = "";
  }

  if (previousObj.id == currentObj.id)
    currentObj.style.backgroundColor = HIGHLIGHT_COLOUR;

  previousObj = currentObj;

  if(document.all)
    document.body.onkeydown = insertNumber;
  else
  	document.documentElement.onkeydown = insertNumber;
}

function insertNumber(e){
  if (isRevealed) return false;

  if (previousObj.style.backgroundColor == "rgb(221, 221, 221)") return false;

  if (e.keyCode)
    code = e.keyCode;
  else if (e.which)
    code = e.which;

  if (code == 8)
    currentObj.innerHTML = ""

  if (code >= 37 && code <= 40){
    var [i, _, j] = currentObj.id;
    var i = +i, j = +j
    var nextObject;

    if (code == 39){
      nextObject = document.getElementById(`${i}x${j + 1}`);
      if (j < 8){
        if(nextObject.style.backgroundColor){
					while (j <= 8 && nextObject.style.backgroundColor)
						nextObject = document.getElementById(`${i}x${++j}`);
        }
      }
    }
    else if (code == 37){
      nextObject = document.getElementById(`${i}x${j - 1}`);
      if (j > 0){
        if(nextObject.style.backgroundColor){
          while (j >= 0 && nextObject.style.backgroundColor)
            nextObject = document.getElementById(`${i}x${--j}`);
        }
      }
    }
    else if (code == 40){
      nextObject = document.getElementById(`${i + 1}x${j}`);
      if (i < 8){
        if(nextObject.style.backgroundColor){
          while (i <= 8 && nextObject.style.backgroundColor)
            nextObject = document.getElementById(`${++i}x${j}`);
        }
      }
    }
    else{
      nextObject = document.getElementById(`${i - 1}x${j}`);
      if (i > 0){
        if(nextObject.style.backgroundColor){
          while (i >= 0 && nextObject.style.backgroundColor)
            nextObject = document.getElementById(`${--i}x${j}`);
        }
      }
    }

    if (!nextObject || nextObject.style.backgroundColor) return false;

    currentObj = nextObject;
    currentObj.style.backgroundColor = HIGHLIGHT_COLOUR
    previousObj.style.backgroundColor = "";
    previousObj = currentObj;
  }

  var theChar = String.fromCharCode(code);
  if (/[1-9]/.test(theChar))
    currentObj.innerHTML = theChar;
}

function getSudoku(){
  var matrix = [];
  for (var i = 1; i <= 9; i++){
    var row = [];
    for (var j = 1; j <= 9; j++){
      var cur = document.getElementById(i+"x"+j).innerHTML;
      if (!/[1-9]/.test(cur))
        cur = 0;
      row.push(+cur);
    }
    matrix.push(row);
  }
  return matrix;
}

function transformBoard(board){
  if (Array.isArray(board))
    return board;

  else if (typeof(board) === "string"){
    var matrix = board.split(/\s+/g);
    var sudoku = [];
    for (var i = 0; i < matrix.length; i++)
      sudoku.push([...matrix[i]]);

    return sudoku;
  }
}

function createSudoku(board, isReset=false){
  board = transformBoard(board);
  var hiddenBoard = [];

  const getDifficulty = document.getElementsByName("difficulty-setting");
  const difficulty = getDifficulty[0].checked ? 0.35 : getDifficulty[1].checked ? 0.3 : getDifficulty[2].checked ? 0.25 : 0.5;

  for (var i = 1; i <= 9; i++){
    var temp = [];
    for (var j = 1; j <= 9; j++){
      var element = document.getElementById(i+"x"+j);
      if (isReset){
        if (board[i-1][j-1] === 0){
          element.innerHTML = "";
          element.style.backgroundColor = "";
          element.onclick = initialise;
        }
        else{
          element.innerHTML = board[i-1][j-1];
          element.style.backgroundColor = FIXED_NUMBER_COLOUR;
          element.onclick = null;
        }
        continue;
      }

      if (Math.random() <= difficulty){
        temp.push(board[i-1][j-1])
        element.innerHTML = board[i-1][j-1];
        element.style.backgroundColor = FIXED_NUMBER_COLOUR;
        element.onclick = null;
      }
      else{
        temp.push(0);
        element.innerHTML = "";
        element.style.backgroundColor = "";
        element.onclick = initialise;
      }
    }
    hiddenBoard.push(temp);
  }
  return hiddenBoard;
}
var isRevealed = false;

function revealNumbers(hiddenBoard, finalBoard){
  for (var i = 1; i <= 9; i++){
    for (var j = 1; j <= 9; j++){
      const element = document.getElementById(i+"x"+j)
      element.innerHTML = finalBoard[i-1][j-1];
      if (hiddenBoard[i-1][j-1] !== 0)
        element.style.backgroundColor = FIXED_NUMBER_COLOUR;
      else
        element.style.backgroundColor = "";
    }
  }
  isRevealed = true;
}

function isDuplicate(board){
  return board.every(x => new Set(x).size == 9);
}

function validSolution(board){
    const boxes = validateBoxes(board);
    const cols = validateColumns(board);
    const rows = isDuplicate(board);
    return boxes && cols && rows;
}

function validateColumns(board){
  var column = [];
  for(var i = 0; i < 9; i++){
    var temp = [];
    for(var j = 0; j < 9; j++){
      temp.push(board[j][i]);
    }
    column.push(temp);
  }
  return isDuplicate(column);
}

function validateBoxes(board){
  var sudoku = [];
  for (var i = 0; i < 9; i += 3){
    for (var j = 0; j < 9; j += 3){
      var nums = [...board[i].slice(j, j+3),
                  ...board[i+1].slice(j, j+3),
                  ...board[i+2].slice(j, j+3)];
      sudoku.push(nums);
    }
  }
  return isDuplicate(sudoku);
}


function getSolution(puzzle) {
    const findNext = (line, col) => {
        while (line <= 8) {
            while (++col <= 8) {
                if (puzzle[line][col] === 0)
                    return [line, col];
            }
            line++;
            col = -1;
        }
        return undefined;
    };

    const valid = (line, col, i) => {
        for (var k = 0; k < 9; k++) {
            if (puzzle[line][k] === i || puzzle[k][col] === i)
                return false;
        }

        var blockY = line - line % 3;
        var blockX = col - col % 3;
        for (var k = 0; k < 3; k++) {
            for (var j = 0; j < 3; j++) {
                if (puzzle[blockY + k][blockX + j] === i)
                    return false;
            }
        }

        return true;
    };

    const DFS = (line, col) => {
        for (var i = 1; i <= 9; i++) {
            if (valid(line, col, i)) {
                puzzle[line][col] = i;
                var pos = findNext(line, col);
                if (pos === undefined || DFS(pos[0], pos[1]))
                    return true;
                puzzle[line][col] = 0;
            }
        }
        return false;
    };

    var pos = findNext(0, -1);
    if (pos !== undefined)
        DFS(pos[0], pos[1]);
    return puzzle;
}


var h1 = document.getElementsByTagName("h1")[0],
    start = document.getElementById("start"),
    stop = document.getElementById("stop"),
    clear = document.getElementById("clear"),
    seconds = 0, minutes = 0, hours = 0, totalTime = 0,
    t;

function add() {
  seconds++;
  if (seconds >= 60) {
    seconds = 0;
    minutes++;
    if (minutes >= 60) {
      minutes = 0;
      hours++;
    }
  }

  h1.textContent = (hours ? (hours > 9 ? hours : "0" + hours) : "00") + ":" + (minutes ? (minutes > 9 ? minutes : "0" + minutes) : "00") + ":" + (seconds > 9 ? seconds : "0" + seconds);
  totalTime += seconds;
  timer();
}


const testSu = [[9, 0, 0, 0, 8, 0, 0, 0, 1],
 [0, 0, 0, 4, 0, 6, 0, 0, 0],
 [0, 0, 5, 0, 7, 0, 3, 0, 0],
 [0, 6, 0, 0, 0, 0, 0, 4, 0],
 [4, 0, 1, 0, 6, 0, 5, 0, 8],
 [0, 9, 0, 0, 0, 0, 0, 2, 0],
 [0, 0, 7, 0, 3, 0, 2, 0, 0],
 [0, 0, 0, 7, 0, 5, 0, 0, 0],
 [1, 0, 0, 0, 4, 0, 0, 0, 7]];

const solved = [[1, 3, 2, 5, 7, 9, 4, 6, 8],
                [4, 9, 8, 2, 6, 1, 3, 7, 5],
                [7, 5, 6, 3, 8, 4, 2, 1, 9],
                [6, 4, 3, 1, 5, 8, 7, 9, 2],
                [5, 2, 1, 7, 9, 3, 8, 4, 6],
                [9, 8, 7, 4, 2, 6, 5, 3, 1],
                [2, 1, 4, 9, 3, 5, 6, 8, 7],
                [3, 6, 5, 8, 1, 7, 9, 2, 4],
                [8, 7, 9, 6, 4, 2, 1, 5, 3]];


function generateSudoku(matrix){
  matrix = transformBoard(matrix);

	for (var i = 0; i < 9; i += 3){
		for (var j = 0; j < 3; j++){
			row1 = Math.floor(Math.random()*3);
			row2 = Math.floor(Math.random()*3);
			while (row2 == row1){
				row2 = Math.floor(Math.random()*3);
			}
			row1 += i;
			row2 += i;
			var temp = matrix[row1];
			matrix[row1] = matrix[row2];
			matrix[row2] = temp;

			col1 = Math.floor(Math.random()*3);
			col2 = Math.floor(Math.random()*3);
			while (col2 == col1){
				col2 = Math.floor(Math.random()*3);
			}
			col1 += i;
			col2 += i;

			temp = [];
			for (var x = 0; x < matrix.length; x++){
				tempValue = matrix[x][col1];
				matrix[x][col1] = matrix[x][col2];
				matrix[x][col2] = tempValue;
			}
		}
	}
  return matrix;
}

var isGenerated = false;
var finalBoard;
var hiddenBoard;


function newGame(){
  hiddenBoard = undefined;
  isGenerated = true;
  hasGivenUp = false;
  isRevealed = false;

  resetClock();
  clearTimeout(t);

  var span = document.getElementsByTagName("td");
  var getGen = document.getElementsByName("generation-algorithm");

  if (getGen[0].checked){
    finalBoard = generateSudoku(solved);
  }
  if (getGen[1].checked){
    for (var i = 0; i < span.length; i++){
      span[i].onclick = initialise;
      span[i].innerHTML = "";
      span[i].style.backgroundColor = "";
    }
    return false;
  }

  localStorage.attempts = ++attempts;
  timer();
  hiddenBoard = createSudoku(finalBoard);
}

function timer() {
  t = setTimeout(add, 1000);
}

function valid(){
  if (isRevealed) return false;
  if (!isGenerated) return false;

  const isCompleted = validSolution(getSudoku());
  if (isCompleted){
    clearTimeout(t);
    alert("That's right. Well done!");
    localStorage.correctSolutions = ++correctSolutions;

    if (shortestTime === null || totalTime < shortestTime){
      shorestTime = totalTime;
      localStorage.shortestTime = totalTime;
    }
  }
  else{
    alert("That's wrong. Try again.");
  }
}

function restart(){
  var isCustom = document.getElementsByName("generation-algorithm")[1].checked;
  if (!isGenerated) return false;
  if (isCustom)
    isRevealed = false;

  if (isRevealed) return false;
  resetClock();
  createSudoku(hiddenBoard, true);
}

function resetClock(){
  if (!isGenerated) return false;
  h1.textContent = "00:00:00";
  seconds = 0; minutes = 0; hours = 0, totalTime = 0;
}

function showSolution(){
  if (!isGenerated) return false;
  if (document.getElementsByName("generation-algorithm")[1].checked){
    hiddenBoard = getSudoku();
    var hiddenCustomBoard = getSudoku();
    var finalCustomBoard = getSolution(hiddenCustomBoard);

    revealNumbers(hiddenBoard, finalCustomBoard);
  }
  else {
    localStorage.givenUp = ++givenUp;
    clearTimeout(t);
    isRevealed = false;
    revealNumbers(hiddenBoard, finalBoard);
  }
  var span = document.getElementsByTagName("td");

  for (var i = 0; i < span.length; i++)
    span[i].onclick = null;
}

</script>
