---
layout: minimal
published: true
---

<!--
TODO
- Generation Algorithm
- Solution Algorithm
- Seeded Algorithm using text files
-->

<style type="text/css">
table {
   border-collapse: collapse;
   font-family: Calibri, sans-serif;
}
colgroup, tbody {
  border: solid medium;
}
td {
  border: solid thin;
  height: 50px; width: 50px;
  text-align: center; padding: 0;
}
#draggable {
  width: 150px; height: 150px; padding: 0.5em;
}

</style>

<head>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $( function() {
    $( "#draggable" ).draggable();
  } );
  </script>
</head>


<div style="padding-left:375px;">
  <div style="position:fixed; margin-right:-375px; right:375px; height:75%; width:350px" id="draggable" class="ui-widget-content">
    <fieldset><legend>Sudoku Options</legend>
      See documentation <a href="https://www.samnayak.com/15-09-2016-sudoku/">here</a>
      <br>1. No duplicates of the numbers 1-9 horizontally</br>
  		2. No duplicates of the numbers 1-9 vertically
  		<br>3. No duplicates of the numbers 1-9 in the 3x3 cell groups</br>
      <p>
        Size:
        <input id="inputHeight" type="number" min="20" max="70" value="60"> x
        <input id="inputWidth" type="number" min="20" max="70" value="60">

      </p>
      <p>
        Generation Algorithm:<br>
        <label><input type="radio" name="generation-algorithm" id="rseed" checked>Random Seed</label><br/>
        <label><input type="radio" name="generation-algorithm" id="random">Random Generation</label><br/>
        <label><input type="radio" name="generation-algorithm" id="iseed">Input Seed:  </label>
        <input id="inputSeed" type="number" style="width:75;"><br/>
      </p>
      <p>
        Solution Algorithm:<br>
        <label><input type="radio" name="solution-algorithm" id="backtracking" checked>Backtracking (Brute Force)</label><br>
        <label><input type="radio" name="solution-algorithm" id="intersection">Intersection Removal</label><br>
      </p>
      <p>
        Difficulty:<br>
        <label><input type="radio" name="difficulty-setting">Easy</label><br>
        <label><input type="radio" name="difficulty-setting" checked>Medium</label><br>
        <label><input type="radio" name="difficulty-setting">Hard</label><br>
      </p>
      <h1><time>00:00:00</time></h1>
      <button id="start" onclick="newGame()">New Game</button>
      <button onclick="valid()">Validate</button>
      <button onclick="restart()">Restart</button>
      <button onclick="showSolution()">Show Solution</button>
      <button onclick="showStatistics()">Show Statistics</button>
      <button onclick="showRules()">Show Rules</button>
    </fieldset>
  </div>
</div>

<div style="padding-left:250px;padding-top:50px;">

<table>
   <tr> <td id='1x1'> <td id='1x2'> <td id='1x3'> <td id='1x4'> <td id='1x5'> <td id='1x6'> <td id='1x7'> <td id='1x8'> <td id='1x9'>
   <tr> <td id='2x1'> <td id='2x2'> <td id='2x3'> <td id='2x4'> <td id='2x5'> <td id='2x6'> <td id='2x7'> <td id='2x8'> <td id='2x9'>
   <tr> <td id='3x1'> <td id='3x2'> <td id='3x3'> <td id='3x4'> <td id='3x5'> <td id='3x6'> <td id='3x7'> <td id='3x8'> <td id='3x9'>
  <colgroup><col><col><col>
  <tbody>
   <tr> <td id='4x1'> <td id='4x2'> <td id='4x3'> <td id='4x4'> <td id='4x5'> <td id='4x6'> <td id='4x7'> <td id='4x8'> <td id='4x9'>
   <tr> <td id='5x1'> <td id='5x2'> <td id='5x3'> <td id='5x4'> <td id='5x5'> <td id='5x6'> <td id='5x7'> <td id='5x8'> <td id='5x9'>
   <tr> <td id='6x1'> <td id='6x2'> <td id='6x3'> <td id='6x4'> <td id='6x5'> <td id='6x6'> <td id='6x7'> <td id='6x8'> <td id='6x9'>
  <colgroup><col><col><col>
  <tbody>
   <tr> <td id='7x1'> <td id='7x2'> <td id='7x3'> <td id='7x4'> <td id='7x5'> <td id='7x6'> <td id='7x7'> <td id='7x8'> <td id='7x9'>
   <tr> <td id='8x1'> <td id='8x2'> <td id='8x3'> <td id='8x4'> <td id='8x5'> <td id='8x6'> <td id='8x7'> <td id='8x8'> <td id='8x9'>
   <tr> <td id='9x1'> <td id='9x2'> <td id='9x3'> <td id='9x4'> <td id='9x5'> <td id='9x6'> <td id='9x7'> <td id='9x8'> <td id='9x9'>
</table>

</div>

<script type="text/javascript">

if(typeof(Storage) !== "undefined") {
  if (localStorage.correctSolutions) {
    var correctSolutions = localStorage.correctSolutions
    var attempts = localStorage.attempts;
  }
  else {
    var correctSolutions = 0;
    var attempts = 0;
  }
}

function showStatistics(){
  alert("");
}

function showRules(){
  alert("");
}

var currentObj;
var previousObj;

function initialise(e){
  currentObj = this;
  currentObj.style.backgroundColor='#ADD8E6';

  if (previousObj === undefined)
    previousObj = currentObj;
  else {
    previousObj.style.backgroundColor = ''
  }
  previousObj = currentObj;

  if(document.all)
    document.body.onkeydown = insertNumber;
  else
  	document.documentElement.onkeydown = insertNumber;
}

function insertNumber(e){
  if (e.keyCode)
    code = e.keyCode;
  else if (e.which)
    code = e.which;

  var theChar = String.fromCharCode(code);
  if (/[1-9]/.test(theChar)){
    currentObj.innerHTML = theChar;
    //currentObj.style.backgroundColor = '';
  }
}

function getSudoku(){
  var matrix = [];
  for (var i = 1; i <= 9; i++){
    var row = [];
    for (var j = 1; j <= 9; j++){
      const cur = document.getElementById(i+"x"+j).innerHTML;
      if (!/[1-9]/.test(cur))
        return false;
      row.push(cur);
    }
    matrix.push(row);
  }
  return matrix;
}

function transformBoard(board){
  if (Array.isArray(board))
    return board;

  else if (typeof(board) === "string"){
    var matrix = board.split(/\s+/g);
    var sudoku = [];
    for (var i = 0; i < matrix.length; i++)
      sudoku.push([...matrix[i]]);

    return sudoku;
  }
}

function createSudoku(board){
  board = transformBoard(board);

  const getDifficulty = document.getElementsByName("difficulty-setting");
  const difficulty = getDifficulty[0].checked ? 0.30 : getDifficulty[1].checked ? 0.25 : getDifficulty[2].checked ? 0.20 : 0.5;

  for (var i = 1; i <= 9; i++){
    for (var j = 1; j <= 9; j++){
      const element = document.getElementById(i+"x"+j)
      if (Math.random() <= difficulty && element.style.backgroundColor!='#DDD'){
        element.innerHTML = board[i-1][j-1];
        element.style.backgroundColor='#DDD';
      }
      else{
        element.innerHTML = "";
        element.style.backgroundColor = "";
      }
    }
  }
}
var isRevealed = false;
function revealNumbers(board){
  for (var i = 1; i <= 9; i++){
    for (var j = 1; j <= 9; j++){
      const element = document.getElementById(i+"x"+j)
      element.innerHTML = board[i-1][j-1];
      element.style.backgroundColor='#DDD';
    }
  }
  isRevealed = true;
}

function isDuplicate(board){
  return board.every(x => new Set(x).size == 9);
}

function validSolution(board){
    const boxes = validateBoxes(board);
    const cols = validateColumns(board);
    const rows = isDuplicate(board);
    return boxes && cols && rows;
}

function validateColumns(board){
  var column = [];
  for(var i = 0; i < 9; i++){
    var temp = [];
    for(var j = 0; j < 9; j++){
      temp.push(board[j][i]);
    }
    column.push(temp);
  }
  return isDuplicate(column);
}

function validateBoxes(board){
  var sudoku = [];
  for (var i = 0; i < 9; i += 3){
    for (var j = 0; j < 9; j += 3){
      var nums = [...board[i].slice(j, j+3), ...board[i+1].slice(j, j+3), ...board[i+2].slice(j, j+3)];
      sudoku.push(nums);
    }
  }
  return isDuplicate(sudoku);
}


function getSolution(puzzle) {
    const findNext = (line, col) => {
        while (line <= 8) {
            while (++col <= 8) {
                if (puzzle[line][col] === 0)
                    return [line, col];
            }
            line++;
            col = -1;
        }
        return undefined;
    };

    const valid = (line, col, i) => {
        for (var k = 0; k < 9; k++) {
            if (puzzle[line][k] === i || puzzle[k][col] === i)
                return false;
        }

        var blockY = line - line % 3;
        var blockX = col - col % 3;
        for (var k = 0; k < 3; k++) {
            for (var j = 0; j < 3; j++) {
                if (puzzle[blockY + k][blockX + j] === i)
                    return false;
            }
        }

        return true;
    };

    const DFS = (line, col) => {
        for (var i = 1; i <= 9; i++) {
            if (valid(line, col, i)) {
                puzzle[line][col] = i;
                var pos = findNext(line, col);
                if (pos === undefined || DFS(pos[0], pos[1]))
                    return true;
                puzzle[line][col] = 0;
            }
        }
        return false;
    };

    var pos = findNext(0, -1);
    if (pos !== undefined)
        DFS(pos[0], pos[1]);
    return puzzle;
}






var changeDimensions = document.getElementsByTagName("td");

document.getElementById("inputHeight").addEventListener("input", () => {
  const elementHeight = document.getElementById("inputHeight").value;
  for(var i = 0; i < changeDimensions.length; i++) {
    changeDimensions[i].style.height = elementHeight + "px";
  }
}, false);

document.getElementById("inputWidth").addEventListener("input", () => {
  const elementWidth = document.getElementById("inputWidth").value;
  for(var i = 0; i < changeDimensions.length; i++) {
    changeDimensions[i].style.width = elementWidth + "px";
  }
}, false);



var h1 = document.getElementsByTagName('h1')[0],
    start = document.getElementById('start'),
    stop = document.getElementById('stop'),
    clear = document.getElementById('clear'),
    seconds = 0, minutes = 0, hours = 0,
    t;

function add() {
  seconds++;
  if (seconds >= 60) {
    seconds = 0;
    minutes++;
    if (minutes >= 60) {
      minutes = 0;
      hours++;
    }
  }

  h1.textContent = (hours ? (hours > 9 ? hours : "0" + hours) : "00") + ":" + (minutes ? (minutes > 9 ? minutes : "0" + minutes) : "00") + ":" + (seconds > 9 ? seconds : "0" + seconds);

  timer();
}


const testSu = [[9, 0, 0, 0, 8, 0, 0, 0, 1],
 [0, 0, 0, 4, 0, 6, 0, 0, 0],
 [0, 0, 5, 0, 7, 0, 3, 0, 0],
 [0, 6, 0, 0, 0, 0, 0, 4, 0],
 [4, 0, 1, 0, 6, 0, 5, 0, 8],
 [0, 9, 0, 0, 0, 0, 0, 2, 0],
 [0, 0, 7, 0, 3, 0, 2, 0, 0],
 [0, 0, 0, 7, 0, 5, 0, 0, 0],
 [1, 0, 0, 0, 4, 0, 0, 0, 7]];

const solved = [[1, 3, 2, 5, 7, 9, 4, 6, 8],
               [4, 9, 8, 2, 6, 1, 3, 7, 5],
               [7, 5, 6, 3, 8, 4, 2, 1, 9],
               [6, 4, 3, 1, 5, 8, 7, 9, 2],
               [5, 2, 1, 7, 9, 3, 8, 4, 6],
               [9, 8, 7, 4, 2, 6, 5, 3, 1],
               [2, 1, 4, 9, 3, 5, 6, 8, 7],
               [3, 6, 5, 8, 1, 7, 9, 2, 4],
               [8, 7, 9, 6, 4, 2, 1, 5, 3]];


function generateSudoku(matrix){
  matrix = transformBoard(matrix);

	for(var no=0;no<9;no+=3){
		for(var no2=0;no2<3;no2++){
			row1 = Math.floor(Math.random()*3);
			row2 = Math.floor(Math.random()*3);
			while(row2==row1){
				row2 = Math.floor(Math.random()*3);
			}
			row1 = row1 + no;
			row2 = row2 + no;
			var tmpMatrix = new Array();
			tmpMatrix = matrix[row1];
			matrix[row1] = matrix[row2];
			matrix[row2] = tmpMatrix;
		}
	}

	for(var no=0;no<9;no+=3){
		for(var no2=0;no2<3;no2++){
			col1 = Math.floor(Math.random()*3);
			col2 = Math.floor(Math.random()*3);
			while(col2==col1){
				col2 = Math.floor(Math.random()*3);
			}
			col1 = col1 + no;
			col2 = col2 + no;

			var tmpMatrix = new Array();
			for(var no3=0;no3<matrix.length;no3++){
				tmpMatrixValue = matrix[no3][col1];
				matrix[no3][col1] = matrix[no3][col2];
				matrix[no3][col2] = tmpMatrixValue;
			}
		}
	}
  return matrix;
}

var finalBoard;
function newGame(){
  var getGen = document.getElementsByName("generation-algorithm");
  if (getGen[0].checked){
    finalBoard = generateSudoku(solved);
  }
  else {
    var read = new XMLHttpRequest();
    //read.open('GET', 'test_sudoku.txt', false);
    //read.send();
    //const BOARD = read.responseText;
    if (getGen[1].checked){
      var rand = Math.floor(Math.random() * 1000) + 1; //max and min seeds
    }
    else if (getGen[2].checked){
      var getSeed = document.getElementById("inputSeed").value;
      if (!getSeed)
        return false;
    }
  }
  attempts++;
  localStorage.attempts = attempts;

  resetClock();
  clearTimeout(t);
  timer();
  createSudoku(finalBoard);

  var span = document.getElementsByTagName("td");

  for (var i = 0; i < span.length; i++){
    if (!span[i].innerHTML.trim())
      span[i].onclick = initialise;
    else
      span[i].onclick = null;
  }
}

function timer() {
  t = setTimeout(add, 1000);
}

function valid(){

  if (isRevealed){
    return false;
  }

  const cur = getSudoku();
  if (cur){
    const isCompleted = validSolution(cur);
    if (isCompleted){
      clearTimeout(t);
      alert("That's right. Well done!");
      correctSolutions++;
      localStorage.correctSolutions = correctSolutions;
    }
    else{
      alert("That's wrong. Try again.");
    }
  }
  else{
    alert("That's wrong. Try again.");
  }
}

function restart(){
  resetClock();
  createSudoku(finalBoard);
}

function resetClock(){
  h1.textContent = "00:00:00";
  seconds = 0; minutes = 0; hours = 0;
}

function showSolution(){
  clearTimeout(t);
  const solution = getSolution(newBoard);
  revealNumbers(solution);
}

</script>
